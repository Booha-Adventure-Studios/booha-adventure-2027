
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Booha Adventure 2027</title>
  <style>
    :root{
      --bg:#000;
      --pink:#ff3bbd;
      --pink2:#ff79d7;
      --text:#ffffff;
      --muted:rgba(255,255,255,.7);
      --safe-top: env(safe-area-inset-top);
      --safe-right: env(safe-area-inset-right);
      --safe-bottom: env(safe-area-inset-bottom);
      --safe-left: env(safe-area-inset-left);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; background:var(--bg); color:var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif; }

    /* App container */
    #app{ position:fixed; inset:0; background:var(--bg); overflow:hidden; }

    /* Simple landscape guidance overlay (placeholder; can be styled later) */
    #rotateOverlay{
      position:absolute; inset:0;
      display:none;
      align-items:center; justify-content:center;
      padding: calc(24px + var(--safe-top)) calc(24px + var(--safe-right)) calc(24px + var(--safe-bottom)) calc(24px + var(--safe-left));
      text-align:center;
      background:rgba(0,0,0,.92);
      z-index:50;
    }
    #rotateOverlay .card{
      max-width:520px;
      border:1px solid rgba(255,255,255,.18);
      border-radius:22px;
      padding:22px 18px;
    }
    #rotateOverlay h2{ margin:0 0 8px; font-size:22px; letter-spacing:.5px; }
    #rotateOverlay p{ margin:0; color:var(--muted); line-height:1.4; }

    /* Scenes */
    .scene{ position:absolute; inset:0; display:none; }
    .scene.active{ display:flex; }

    /* START scene */
    #startScene{
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:18px;
      padding: calc(24px + var(--safe-top)) calc(24px + var(--safe-right)) calc(24px + var(--safe-bottom)) calc(24px + var(--safe-left));
    }

    /* Ghost + sparkles container (consistent across devices) */
    .ghostOuter{
      position: relative;
      width: min(32vmin, 260px);
      height: min(32vmin, 260px);
      /* intentionally NO overflow:hidden */
      transform: translateZ(0);
    }

    /* ghostWrap fills ghostOuter */
    .ghostWrap{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      pointer-events:none;
      animation: floaty 3.8s ease-in-out infinite;
      filter: drop-shadow(0 14px 28px rgba(0,0,0,.75));
      will-change: transform, opacity;
      transform: translateZ(0);
    }

    .ghostWrap.flyAway{
      animation:none;
      transition:
        transform 1800ms cubic-bezier(.15,.8,.25,1),
        opacity 1600ms ease 200ms;
      transform: translate3d(0,-85vh,0) scale(.7) rotate(-4deg);
      opacity:0;
    }

    .sparkleField{
      position:absolute;
      inset:-60px;
      pointer-events:none;
    }

    .sp{
      position:absolute;
      border-radius:50%;
      background:#fff;
      opacity:0;
      animation: sparkleLife var(--dur) ease-in-out var(--delay) infinite;
      width: var(--size);
      height: var(--size);
      top: var(--y);
      left: var(--x);
      box-shadow:
        0 0 4px 1px rgba(255,255,255,.9),
        0 0 10px 3px rgba(255,100,220,.6);
    }

    @keyframes sparkleLife{
      0%{ opacity:0; transform: scale(.4) translateY(0px); }
      20%{ opacity:1; transform: scale(1) translateY(-6px); }
      60%{ opacity:.85; transform: scale(.9) translateY(-14px); }
      100%{ opacity:0; transform: scale(.3) translateY(-22px); }
    }

    #boohaGhost{
      width: 100%;
      height: 100%;
      object-fit: contain;
      user-select:none;
      -webkit-user-drag:none;
    }

    .startText{ text-align:center; }
    .startText .line1{ font-size:16px; letter-spacing:.2px; color:var(--muted); }
    .startText .line2{ font-size:14px; letter-spacing:.2px; color:rgba(255,255,255,.55); margin-top:6px; }

    .btn{
      appearance:none;
      border:0;
      border-radius: 999px;
      padding: 14px 22px;
      font-size: 18px;
      font-weight: 900;
      letter-spacing: .6px;
      cursor:pointer;
      color:#000;
      background: linear-gradient(180deg, var(--pink2), var(--pink));
      box-shadow:
        0 10px 22px rgba(255,59,189,.28),
        0 0 0 2px rgba(255,59,189,.15),
        0 0 26px rgba(255,59,189,.35);
      transform: translateZ(0);
      -webkit-tap-highlight-color: transparent;
    }
    .btn:active{ transform: scale(.98); }

    /* VIDEO scene */
    #videoScene{
      align-items:center;
      justify-content:center;
      background:#000;
    }

    /* Fit video in landscape, keep crisp */
    #introVideo{
      width: 100%;
      height: 100%;
      object-fit: cover;
      background:#000;
    }

    /* Fade layer */
    #fade{
      position:absolute;
      inset:0;
      background:#000;
      opacity:0;
      pointer-events:none;
      transition: opacity 520ms ease;
      z-index:40;
    }
    #fade.on{ opacity:1; }

    /* HUB placeholder */
    #hubScene{
      padding: calc(22px + var(--safe-top)) calc(22px + var(--safe-right)) calc(22px + var(--safe-bottom)) calc(22px + var(--safe-left));
      align-items:center;
      justify-content:center;
      background:#000;
    }

    .hub{
      width:min(1100px, 100%);
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .hubRow{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:12px;
    }

    .weekCard{
      border-radius:22px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      padding:14px 14px 12px;
      min-height: 150px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
      transform: translateZ(0);
    }
    .weekCard:active{ transform: scale(.99); }

    .weekTag{
      font-weight: 1000;
      letter-spacing: 1px;
      font-size: 14px;
    }
    .weekTag span{ color: rgba(255,255,255,.75); font-weight: 900; margin-left: 6px; }

    .weekTitle{
      font-size: 20px;
      font-weight: 1000;
      letter-spacing: .4px;
      margin-top: 10px;
    }

    .weekDates{
      font-size: 14px;
      color: rgba(255,255,255,.72);
      margin-top: 6px;
    }

    .weekHint{
      margin-top: 12px;
      font-size: 12px;
      color: rgba(255,255,255,.55);
    }

    .hubBottom{ display:flex; justify-content:center; padding-top: 4px; }

    .btnSmall{ padding: 12px 18px; font-size: 16px; }

    @media (max-width: 860px){
      .hubRow{ grid-template-columns: 1fr; }
      .weekCard{ min-height: 120px; }
    }

    /* Picker overlay */
    .picker{
      position:absolute; inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding: calc(18px + var(--safe-top)) calc(18px + var(--safe-right)) calc(18px + var(--safe-bottom)) calc(18px + var(--safe-left));
      background: rgba(0,0,0,.86);
      z-index: 60;
    }
    .picker.show{ display:flex; }

    .pickerPanel{
      width: min(900px, 100%);
      border-radius: 26px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(20,20,20,.92);
      box-shadow: 0 24px 60px rgba(0,0,0,.65);
      padding: 16px;
    }

    .pickerTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }

    .pickerTitle{
      font-size: 18px;
      font-weight: 1000;
      letter-spacing: 1px;
    }

    .ghostBtn{
      appearance:none;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 1000;
      letter-spacing: .4px;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .ghostBtn:active{ transform: scale(.99); }

    .pickerSub{ margin-top: 8px; color: rgba(255,255,255,.75); font-size: 14px; }

    .pickerGrid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
      margin-top: 14px;
    }

    .pickTile{
      appearance:none;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.92);
      border-radius: 22px;
      padding: 18px 14px;
      font-size: 16px;
      font-weight: 1000;
      letter-spacing: .3px;
      cursor:pointer;
    }
    .pickTile span{ display:block; margin-top: 8px; font-size: 13px; color: rgba(255,255,255,.70); font-weight: 900; }
    .pickTile:active{ transform: scale(.99); }

    .pickerNote{ margin-top: 14px; font-size: 12px; color: rgba(255,255,255,.58); }

    @media (max-width: 860px){
      .pickerGrid{ grid-template-columns: 1fr; }
    }

    /* Responsive tweaks */
    @media (max-width: 780px){
      .grid{ grid-template-columns: 1fr; }
      .tile{ min-height: 110px; }
    }

    /* Prefer-reduced-motion */
    @media (prefers-reduced-motion: reduce){
      .ghostWrap{ animation:none; }
      #fade{ transition:none; }
    }
  </style>
</head>
<body>
  <div id="app">

    <div id="rotateOverlay" aria-hidden="true">
      <div class="card">
        <h2>Rotate to Landscape</h2>
        <p>Please turn your device sideways for Booha Adventure.</p>
      </div>
    </div>

    <!-- START -->
    <section id="startScene" class="scene active" aria-label="Start">
      <div class="ghostOuter">
        <div class="sparkleField" aria-hidden="true"></div>
        <div class="ghostWrap" aria-hidden="true">
          <img id="boohaGhost" src="assets/img/booha_ghost.png" alt="Booha" />
        </div>
      </div>

      <button id="startBtn" class="btn" type="button">スタート</button>
    </section>

    <!-- VIDEO -->
    <section id="videoScene" class="scene" aria-label="Intro video">
      <video id="introVideo" preload="auto" playsinline webkit-playsinline>
        <source src="assets/video/intro.mp4" type="video/mp4" />
      </video>
    </section>

    <!-- HUB (3-week window) -->
    <section id="hubScene" class="scene" aria-label="Week Hub">
      <div class="hub">
        <div class="hubRow" id="weekCards">
          <!-- cards injected by JS -->
        </div>

        <div class="hubBottom">
          <button id="mazeBtn" class="btn btnSmall" type="button">めいろへ（Maze）</button>
        </div>
      </div>
    </section>

    <!-- Curriculum picker (placeholder) -->
    <div id="picker" class="picker" aria-hidden="true">
      <div class="pickerPanel" role="dialog" aria-modal="true" aria-label="Choose Curriculum">
        <div class="pickerTop">
          <div class="pickerTitle" id="pickerTitle">THIS WEEK（今週）</div>
          <button id="pickerClose" class="ghostBtn" type="button" aria-label="Back">戻る</button>
        </div>

        <div class="pickerSub" id="pickerDates">Jan 3 – Jan 9（1月3日–1月9日）</div>

        <div class="pickerGrid">
          <button class="pickTile" type="button" data-curr="preboo">Pre-Boo<br><span>プレブー</span></button>
          <button class="pickTile" type="button" data-curr="booriculum">Boo-riculum<br><span>ブーリキュラム</span></button>
          <button class="pickTile" type="button" data-curr="boocontinuum">Boo-continuum<br><span>ブーコンティニューム</span></button>
        </div>

        <div class="pickerNote">※ ここはプレースホルダーです（後でリンクします）</div>
      </div>
    </div>

    <div id="fade" aria-hidden="true"></div>
  </div>

  <script>
    const startScene = document.getElementById('startScene');
    const videoScene = document.getElementById('videoScene');
    const hubScene   = document.getElementById('hubScene');
    const startBtn   = document.getElementById('startBtn');
    const introVideo = document.getElementById('introVideo');
    const fade       = document.getElementById('fade');
    const rotateOverlay = document.getElementById('rotateOverlay');
    const ghostWrap = document.querySelector('.ghostWrap');
    const sparkleField = document.querySelector('.sparkleField');

    // --- Scene helpers ---
    function showScene(sceneEl){
      for (const el of [startScene, videoScene, hubScene]) el.classList.remove('active');
      sceneEl.classList.add('active');
    }

    function fadeToBlack(on=true){
      fade.classList.toggle('on', !!on);
    }

    // --- Landscape guidance (non-blocking for desktop) ---
    function updateOrientationOverlay(){
      const isPortrait = window.matchMedia('(orientation: portrait)').matches;
      // Show on small devices only (so desktop resizing doesn't annoy you)
      const small = Math.min(window.innerWidth, window.innerHeight) < 700;
      const show = small && isPortrait;
      rotateOverlay.style.display = show ? 'flex' : 'none';
      rotateOverlay.setAttribute('aria-hidden', show ? 'false' : 'true');
    }
    window.addEventListener('resize', updateOrientationOverlay, { passive:true });
    updateOrientationOverlay();

    // --- Week hub (auto 48-week cycle; only LAST/THIS/NEXT openable) ---
    const YEAR_URL = 'data/year.json';

    const MONTH_NAME = {
      jan:'January', feb:'February', mar:'March', apr:'April', may:'May', jun:'June',
      jul:'July', aug:'August', sep:'September', oct:'October', nov:'November', dec:'December'
    };

    function tokyoTodayYMD(){
      const parts = new Intl.DateTimeFormat('en-US', {
        timeZone: 'Asia/Tokyo',
        year: 'numeric', month: '2-digit', day: '2-digit'
      }).formatToParts(new Date());
      const map = Object.fromEntries(parts.filter(p=>p.type!=='literal').map(p=>[p.type,p.value]));
      return { y: +map.year, m: +map.month, d: +map.day };
    }

    function ymdToUtcMs(y,m,d){
      return Date.UTC(y, m-1, d, 0, 0, 0);
    }

    function parseYMD(str){
      const [y,m,d] = str.split('-').map(n=>+n);
      return { y, m, d };
    }

    function addDaysToYMD(ymd, add){
      const ms = ymdToUtcMs(ymd.y, ymd.m, ymd.d) + add*86400000;
      const dt = new Date(ms);
      return { y: dt.getUTCFullYear(), m: dt.getUTCMonth()+1, d: dt.getUTCDate() };
    }

    function fmtRange(startYMD, endYMD){
      const en = (ymd) => {
        const mm = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'][ymd.m-1];
        return `${mm} ${ymd.d}`;
      };
      const jp = (ymd) => `${ymd.m}月${ymd.d}日`;
      return `${en(startYMD)} – ${en(endYMD)}（${jp(startYMD)}–${jp(endYMD)}）`;
    }

    function labelFromWeekId(weekId){
      if (!weekId) return '—';
      if (weekId.startsWith('2026_')) return 'December Week 4';
      const parts = weekId.split('_');
      const mon = parts[2];
      const wIn = (parts[3]||'w1').replace('w','');
      const monName = MONTH_NAME[mon] || mon;
      return `${monName} Week ${wIn}`;
    }

    function buildCard({ tagEn, tagJp, weekId, title, rangeText, hint }){
      const div = document.createElement('div');
      div.className = 'weekCard';
      div.dataset.weekId = weekId || '';
      div.innerHTML = `
        <div>
          <div class="weekTag">${tagEn}<span>（${tagJp}）</span></div>
          <div class="weekTitle">${title}</div>
          <div class="weekDates">${rangeText}</div>
        </div>
        <div class="weekHint">${hint || 'OPEN'}</div>
      `;
      return div;
    }

    async function loadYearData(){
      const res = await fetch(`${YEAR_URL}?v=${Date.now()}`);
      if (!res.ok) throw new Error('Failed to load year.json');
      return res.json();
    }

    async function renderHub(){
      const weekCards = document.getElementById('weekCards');
      weekCards.innerHTML = '';

      const year = await loadYearData();
      const cycleStart = parseYMD(year.cycleStart);
      const cycleStartMs = ymdToUtcMs(cycleStart.y, cycleStart.m, cycleStart.d);

      const today = tokyoTodayYMD();
      const todayMs = ymdToUtcMs(today.y, today.m, today.d);

      const diffDays = Math.floor((todayMs - cycleStartMs) / 86400000);

      let thisIdx = null;
      let thisWeekId = null;
      let thisStart = null;

      if (diffDays < 0){
        // before Jan 3, 2027
        thisIdx = -1;
        thisWeekId = year.preStartWeek;
        thisStart = addDaysToYMD(cycleStart, -14); // Dec 20, 2026
      } else {
        thisIdx = Math.floor(diffDays / 7) % year.cycleLength;
        thisWeekId = year.weeks[thisIdx];
        thisStart = addDaysToYMD(cycleStart, thisIdx * 7);
      }

      const thisEnd = addDaysToYMD(thisStart, 6);

      let lastWeekId = null, lastStart=null, lastEnd=null;
      let nextWeekId = null, nextStart=null, nextEnd=null;

      if (thisIdx === -1){
        nextWeekId = year.weeks[0];
        nextStart = cycleStart;
        nextEnd = addDaysToYMD(nextStart, 6);
      } else {
        const nIdx = (thisIdx + 1) % year.cycleLength;
        nextWeekId = year.weeks[nIdx];
        nextStart = addDaysToYMD(cycleStart, nIdx * 7);
        nextEnd = addDaysToYMD(nextStart, 6);

        if (thisIdx === 0){
          // Week 1: last is special Dec week 4
          lastWeekId = year.preStartWeek;
          lastStart = addDaysToYMD(cycleStart, -14);
          lastEnd = addDaysToYMD(lastStart, 6);
        } else {
          const lIdx = (thisIdx - 1 + year.cycleLength) % year.cycleLength;
          lastWeekId = year.weeks[lIdx];
          lastStart = addDaysToYMD(cycleStart, lIdx * 7);
          lastEnd = addDaysToYMD(lastStart, 6);
        }
      }

      // Render only 3 openable weeks
      if (lastWeekId){
        weekCards.appendChild(buildCard({
          tagEn:'LAST WEEK', tagJp:'先週',
          weekId:lastWeekId,
          title: labelFromWeekId(lastWeekId),
          rangeText: fmtRange(lastStart, lastEnd)
        }));
      } else {
        weekCards.appendChild(buildCard({
          tagEn:'LAST WEEK', tagJp:'先週',
          weekId:'',
          title:'—',
          rangeText:'—',
          hint:'LOCKED'
        }));
      }

      weekCards.appendChild(buildCard({
        tagEn:'THIS WEEK', tagJp:'今週',
        weekId:thisWeekId,
        title: labelFromWeekId(thisWeekId),
        rangeText: fmtRange(thisStart, thisEnd)
      }));

      weekCards.appendChild(buildCard({
        tagEn:'NEXT WEEK', tagJp:'来週',
        weekId: nextWeekId || '',
        title: nextWeekId ? labelFromWeekId(nextWeekId) : '—',
        rangeText: nextWeekId ? fmtRange(nextStart, nextEnd) : '—',
        hint: nextWeekId ? 'OPEN' : 'LOCKED'
      }));

      // Click -> curriculum picker (placeholder)
      const picker = document.getElementById('picker');
      const pickerTitle = document.getElementById('pickerTitle');
      const pickerDates = document.getElementById('pickerDates');
      const pickerClose = document.getElementById('pickerClose');

      function openPicker(tagEn, tagJp, dates, weekId){
        if (!weekId) return;
        pickerTitle.textContent = `${tagEn}（${tagJp}）`;
        pickerDates.textContent = dates;
        picker.dataset.weekId = weekId;
        picker.classList.add('show');
        picker.setAttribute('aria-hidden','false');
      }
      function closePicker(){
        picker.classList.remove('show');
        picker.setAttribute('aria-hidden','true');
        picker.dataset.weekId = '';
      }

      pickerClose.onclick = closePicker;
      picker.addEventListener('click', (e) => {
        if (e.target === picker) closePicker();
      });

      weekCards.querySelectorAll('.weekCard').forEach(card => {
        card.addEventListener('click', () => {
          const weekId = card.dataset.weekId;
          if (!weekId) return;
          const dates = card.querySelector('.weekDates')?.textContent || '';
          const tag = card.querySelector('.weekTag')?.textContent || '';
          if (tag.includes('LAST WEEK')) openPicker('LAST WEEK','先週', dates, weekId);
          else if (tag.includes('THIS WEEK')) openPicker('THIS WEEK','今週', dates, weekId);
          else openPicker('NEXT WEEK','来週', dates, weekId);
        });
      });

      document.querySelectorAll('.pickTile').forEach(btn => {
        btn.onclick = () => {
          const weekId = picker.dataset.weekId;
          const curr = btn.dataset.curr;
          alert(`PLACEHOLDER
week: ${weekId}
curriculum: ${curr}`);
        };
      });

      const mazeBtn = document.getElementById('mazeBtn');
      if (mazeBtn) mazeBtn.onclick = () => alert('MAZE (placeholder)');
    }

    // --- Start flow ---
    let started = false;

    async function startIntro(){
      if (started) return;
      started = true;

      // Ghost flies away
      ghostWrap.classList.add('flyAway');

      // Fade to black before video starts
      fadeToBlack(true);

      // Wait a beat so the fly-away + fade reads on all devices
      await new Promise(r => setTimeout(r, 900));

      // Move to video scene so the element is visible (helps iOS)
      showScene(videoScene);

      // Ensure video starts from beginning
      try { introVideo.currentTime = 0; } catch(e) {}

      // Keep black for a moment, then reveal video
      setTimeout(() => fadeToBlack(false), 60);

      // Attempt playback (must be initiated by user gesture)
      try {
        await introVideo.play();
      } catch (err){
        // If blocked, fall back
        started = false;
        ghostWrap.classList.remove('flyAway');
        showScene(startScene);
        fadeToBlack(false);
        alert('もう一度「スタート」をタップしてください。');
        return;
      }
    }

    startBtn.addEventListener('click', startIntro);

    // Sparkles (pure CSS animation; JS only randomizes positions)
    (function initSparkles(){
      if (!sparkleField) return;
      const COUNT = 32;
      sparkleField.innerHTML = '';

      for (let i = 0; i < COUNT; i++){
        const sp = document.createElement('div');
        sp.className = 'sp';

        const angle = (i / COUNT) * Math.PI * 2;
        const radius = 28 + Math.random() * 22; // 28–50
        const cx = 50 + Math.cos(angle) * radius;
        const cy = 50 + Math.sin(angle) * radius;

        const size = 2 + Math.random() * 3;     // 2–5px
        const dur = 1.4 + Math.random() * 2.0;  // 1.4–3.4s
        const delay = -(Math.random() * dur);

        sp.style.cssText = `
          --size: ${size}px;
          --x: ${cx}%;
          --y: ${cy}%;
          --dur: ${dur}s;
          --delay: ${delay}s;
        `;

        sparkleField.appendChild(sp);
      }
    })();

    // Fade to Week screen slightly before the end (so it feels cinematic)
    const FADE_MS = 520;
    let fadingOut = false;

    async function goToHub(){
  if (fadingOut) return;
  fadingOut = true;
  fadeToBlack(true);

  setTimeout(async () => {
    try { introVideo.pause(); } catch(e) {}
    showScene(hubScene);

    // This builds LAST / THIS / NEXT from year.json
    try { await renderHub(); } catch (e){ console.error(e); }

    requestAnimationFrame(() => {
      requestAnimationFrame(() => fadeToBlack(false));
    });
  }, FADE_MS);
}

introVideo.addEventListener('timeupdate', () => {
  const d = introVideo.duration;
  if (!isFinite(d) || d <= 0) return;
  const remaining = d - introVideo.currentTime;
  if (remaining <= 0.65) goToHub();
});

// Fallback if ended fires before timeupdate threshold
introVideo.addEventListener('ended', goToHub);

   // Safety: if video errors, just go to hub
introVideo.addEventListener('error', () => {
  fadeToBlack(true);

  setTimeout(async () => {
    showScene(hubScene);

    // IMPORTANT: build the 3-week window
    try { await renderHub(); } catch (e){ console.error(e); }

    requestAnimationFrame(() =>
      requestAnimationFrame(() => fadeToBlack(false))
    );
  }, FADE_MS);
});

    // iOS/Safari best practice: pause video when leaving the page
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        try { introVideo.pause(); } catch(e) {}
      }
    });
  </script>
</body>
</html>
