
<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Booha Adventure 2027 ‚Äî Maze</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Bowlby+One&display=swap" rel="stylesheet" />
  <style>
    :root{
      --pink:#ff3bbd; --pink2:#ff79d7;
      --blue:#3bc8ff; --blue2:#79dfff;
      --safe-top: env(safe-area-inset-top);
      --safe-right: env(safe-area-inset-right);
      --safe-bottom: env(safe-area-inset-bottom);
      --safe-left: env(safe-area-inset-left);
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; background:#000; color:#fff;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,
        "Noto Sans","Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif; }
    #app{ position:fixed; inset:0; background:#000; overflow:hidden; }

    /* ‚îÄ‚îÄ ROTATE ‚îÄ‚îÄ */
    #rotateOverlay{ position:fixed; inset:0; display:none; flex-direction:column;
      align-items:center; justify-content:center; gap:20px; background:#000;
      z-index:9999; text-align:center; padding:32px; }
    #rotateOverlay.show{ display:flex; }
    .rotateIcon{ font-size:68px; display:block; transform-origin:center;
      animation:rotateHint 2.2s ease-in-out infinite; }
    @keyframes rotateHint{
      0%{ transform:rotate(0deg); } 35%{ transform:rotate(-90deg); }
      65%{ transform:rotate(-90deg); } 100%{ transform:rotate(0deg); } }
    .rotateTitle{ font-family:'Bowlby One',sans-serif; font-size:clamp(20px,5vw,28px);
      letter-spacing:2px; color:#fff; margin:0;
      text-shadow:0 0 30px rgba(255,140,255,.7),0 0 60px rgba(255,80,200,.35); }
    .rotateSub{ font-size:15px; color:rgba(255,255,255,.6); margin:0; line-height:1.6; }

    /* ‚îÄ‚îÄ SHARED OVERLAY ‚îÄ‚îÄ */
    .overlay{ position:absolute; inset:0; display:flex; flex-direction:column;
      align-items:center; justify-content:center; gap:28px;
      padding: calc(32px + var(--safe-top)) calc(32px + var(--safe-right))
               calc(32px + var(--safe-bottom)) calc(32px + var(--safe-left));
      background:radial-gradient(ellipse at center,
        rgba(0,0,0,.50) 0%,rgba(0,0,0,.82) 60%,rgba(0,0,0,.96) 100%);
      backdrop-filter:blur(6px); -webkit-backdrop-filter:blur(6px);
      text-align:center; z-index:40; transition:opacity 550ms ease; }
    .overlay.hidden{ opacity:0; pointer-events:none; }
    .overlay.gone{ display:none; }
    .overlayHeading{ font-family:'Bowlby One',sans-serif;
      font-size:clamp(26px,4vw,52px); letter-spacing:3px; margin:0; color:#fff;
      text-shadow:0 0 32px rgba(255,140,255,.7),0 0 80px rgba(255,80,200,.35),
        0 2px 8px rgba(0,0,0,.9); }
    .overlaySub{ font-size:15px; color:rgba(255,255,255,.6); letter-spacing:.4px; margin:0; }
    .btnRow{ display:flex; gap:16px; flex-wrap:wrap; justify-content:center; align-items:center; }

    /* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
    .btnPink{ appearance:none; border:0; border-radius:999px; padding:15px 28px;
      font-size:18px; font-weight:1000; letter-spacing:.6px; cursor:pointer; color:#000;
      background:linear-gradient(180deg,var(--pink2),var(--pink));
      box-shadow:0 10px 22px rgba(255,59,189,.30),0 0 0 2px rgba(255,59,189,.18),
        0 0 28px rgba(255,59,189,.40);
      -webkit-tap-highlight-color:transparent; transform:translateZ(0); }
    .btnPink:active{ transform:scale(.97); }
    .btnBlue{ appearance:none; border:0; border-radius:999px; padding:15px 28px;
      font-size:18px; font-weight:1000; letter-spacing:.6px; cursor:pointer; color:#000;
      background:linear-gradient(180deg,var(--blue2),var(--blue));
      box-shadow:0 10px 22px rgba(59,200,255,.30),0 0 0 2px rgba(59,200,255,.18),
        0 0 28px rgba(59,200,255,.40);
      -webkit-tap-highlight-color:transparent; transform:translateZ(0); }
    .btnBlue:active{ transform:scale(.97); }

    /* ‚îÄ‚îÄ SPARKLES ‚îÄ‚îÄ */
    .sparkleWrap{ position:relative; display:inline-flex; align-items:center; justify-content:center; }
    .sparkleField{ position:absolute; inset:-50px; pointer-events:none; }
    .sp{ position:absolute; border-radius:50%; background:#fff; opacity:0;
      animation:sparkleLife var(--dur) ease-in-out var(--delay) infinite;
      width:var(--size); height:var(--size); top:var(--y); left:var(--x);
      box-shadow:0 0 4px 1px rgba(255,255,255,.9),0 0 10px 3px rgba(255,100,220,.6); }
    @keyframes sparkleLife{
      0%{ opacity:0; transform:scale(.4) translateY(0); }
      20%{ opacity:1; transform:scale(1) translateY(-6px); }
      60%{ opacity:.85; transform:scale(.9) translateY(-14px); }
      100%{ opacity:0; transform:scale(.3) translateY(-22px); } }

    /* ‚îÄ‚îÄ OVERLAY 1 ‚îÄ‚îÄ */
    #overlay1{ z-index:50; }

    /* ‚îÄ‚îÄ VIDEO ‚îÄ‚îÄ */
    #videoWrap{ position:absolute; inset:0; display:none; background:#000; z-index:20; }
    #videoWrap.show{ display:block; }
    #toMazeVideo{ width:100%; height:100%; object-fit:cover; background:#000; }

    /* ‚îÄ‚îÄ OVERLAY 2 ‚îÄ‚îÄ */
    #overlay2{ z-index:45; display:none; }
    #overlay2.show{ display:flex; }

    /* Ghost-as-button */
    .ghostBtnWrap{
      position:relative;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      -webkit-tap-highlight-color:transparent;
      background:none; border:none; padding:0;
    }
    .ghostBtnWrap:active #startGhost{
      transform: scale(.9) translateY(-4px);
      filter:drop-shadow(0 0 40px rgba(255,100,220,1)) drop-shadow(0 14px 30px rgba(0,0,0,.7));
    }
    .ghostSparkleField{
      position:absolute;
      inset:-70px;
      pointer-events:none;
      z-index:0;
    }
    /* larger sparkles for the ghost */
    .ghostSparkleField .sp{
      box-shadow:
        0 0 6px 2px rgba(255,255,255,.95),
        0 0 16px 5px rgba(255,100,220,.75);
    }
    #startGhost{
      width:min(38vmin,250px); height:min(38vmin,250px); object-fit:contain;
      user-select:none; -webkit-user-drag:none;
      filter:drop-shadow(0 0 26px rgba(255,100,220,.6)) drop-shadow(0 14px 30px rgba(0,0,0,.7));
      animation:floaty 3.6s ease-in-out infinite;
      transform-origin:50% 60%;
      transition: transform 120ms ease, filter 120ms ease;
      position:relative; z-index:1;
    }

    /* ‚îÄ‚îÄ MAZE ‚îÄ‚îÄ */
    #mazeScene{ position:absolute; inset:0; background:#000; display:block; }
    #stage{ position:absolute;
      top:calc(0px + var(--safe-top)); right:calc(0px + var(--safe-right));
      bottom:calc(0px + var(--safe-bottom)); left:calc(0px + var(--safe-left));
      display:flex; align-items:center; justify-content:center; padding:8px; }
    #mazeImg{ width:100%; height:100%; max-width:100%; max-height:100%;
      object-fit:contain; user-select:none; -webkit-user-drag:none;
      pointer-events:none; filter:drop-shadow(0 18px 40px rgba(0,0,0,.6)); }
    #hitLayer{ position:absolute; left:0; top:0; width:0; height:0;
      cursor:default; z-index:5; pointer-events:auto; }
    #grid{ position:absolute; inset:0; display:none; pointer-events:none;
      background-image:linear-gradient(to right,rgba(255,255,255,.12) 1px,transparent 1px),
        linear-gradient(to bottom,rgba(255,255,255,.12) 1px,transparent 1px);
      background-size:80px 80px; mix-blend-mode:screen; opacity:.55; }
    #grid.show{ display:block; }
    #crosshair{ position:absolute; inset:0; pointer-events:none; display:none; }
    #crosshair.show{ display:block; }
    .chLineH,.chLineV{ position:absolute; background:rgba(255,255,255,.7);
      box-shadow:0 0 16px rgba(255,255,255,.25); }
    .chLineH{ height:1px; left:0; right:0; top:0; }
    .chLineV{ width:1px; top:0; bottom:0; left:0; }
    .hudTitle{ font-family:'Bowlby One',sans-serif; font-size:clamp(13px,1.8vw,18px);
      letter-spacing:2px; line-height:1.15; color:#fff;
      text-shadow:0 0 22px rgba(255,140,255,.7),0 0 60px rgba(255,80,200,.35),0 2px 6px rgba(0,0,0,.9);
      user-select:none; pointer-events:none; }
    #hud{ position:absolute; left:calc(12px + var(--safe-left)); top:calc(12px + var(--safe-top));
      display:flex; gap:10px; align-items:flex-start; z-index:10; }
    .pill{ border-radius:999px; padding:10px 14px; font-weight:900; letter-spacing:.4px;
      background:rgba(0,0,0,.28); border:1px solid rgba(255,255,255,.16);
      backdrop-filter:blur(14px) saturate(140%); -webkit-backdrop-filter:blur(14px) saturate(140%);
      box-shadow:inset 0 0 0 1px rgba(255,255,255,.08),0 14px 30px rgba(0,0,0,.35);
      color:rgba(255,255,255,.92); user-select:none; }
    #coordPill{ display:none; } #coordPill.show{ display:block; }
    .coordSmall{ font-size:12px; color:rgba(255,255,255,.7); font-weight:800; letter-spacing:1px; }
    .coordBig{ font-size:14px; margin-top:4px; }
    #avatar{ position:absolute; right:calc(12px + var(--safe-right)); top:calc(12px + var(--safe-top));
      width:64px; height:64px; z-index:10; pointer-events:none;
      filter:drop-shadow(0 16px 30px rgba(0,0,0,.55)); opacity:.98; transform-origin:50% 60%;
      animation:floaty 3.8s ease-in-out infinite; }
    @keyframes floaty{
      0%{ transform:translateY(0px) rotate(var(--r,0deg)); }
      50%{ transform:translateY(-10px) rotate(calc(var(--r,0deg) + 2deg)); }
      100%{ transform:translateY(0px) rotate(var(--r,0deg)); } }
    #bryanBtn{ position:absolute; left:calc(12px + var(--safe-left)); bottom:calc(12px + var(--safe-bottom));
      z-index:20; border-radius:999px; padding:10px 12px; font-size:12px; font-weight:1000;
      letter-spacing:1.6px; text-transform:uppercase; color:rgba(255,255,255,.75);
      background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.14);
      backdrop-filter:blur(10px) saturate(140%); -webkit-backdrop-filter:blur(10px) saturate(140%);
      cursor:pointer; -webkit-tap-highlight-color:transparent; }
    #bryanBtn.on{ color:#fff; border-color:rgba(255,255,255,.22);
      box-shadow:0 0 0 2px rgba(255,59,189,.18),0 0 26px rgba(255,59,189,.25); }
    #bryanBtn:active{ transform:scale(.99); }
    #backBtn{ position:absolute; right:calc(12px + var(--safe-right)); bottom:calc(12px + var(--safe-bottom));
      z-index:20; appearance:none; border:0; border-radius:999px; padding:12px 20px;
      font-size:15px; font-weight:1000; letter-spacing:.6px; cursor:pointer; color:#000;
      background:linear-gradient(180deg,var(--pink2),var(--pink));
      box-shadow:0 8px 20px rgba(255,59,189,.30),0 0 0 2px rgba(255,59,189,.18),0 0 28px rgba(255,59,189,.40);
      -webkit-tap-highlight-color:transparent; transform:translateZ(0); }
    #backBtn:active{ transform:scale(.98); }

    /* ‚îÄ‚îÄ FADE ‚îÄ‚îÄ */
    #fade{ position:fixed; inset:0; background:#000; opacity:0;
      pointer-events:none; transition:opacity 520ms ease; z-index:200; }
    #fade.on{ opacity:1; }

    @media (prefers-reduced-motion:reduce){
      #avatar,#startGhost{ animation:none; }
      .rotateIcon{ animation:none; transform:rotate(-90deg); }
      #fade{ transition:none; }
      .sp{ animation:none; opacity:.6; } }
  </style>
</head>
<body>
<div id="app">

  <!-- ROTATE OVERLAY -->
  <div id="rotateOverlay" role="alert" aria-live="polite">
    <span class="rotateIcon">üì±</span>
    <h1 class="rotateTitle">„Çà„Åì„ÇÄ„Åç„Å´„Åó„Å¶„Å≠ÔºÅ</h1>
    <p class="rotateSub">„ÇÅ„ÅÑ„Çç„Çí„ÅÇ„Åù„Å∂„Å´„ÅØ<br>„Çπ„Éû„Éõ„Çí„Çà„Åì„Å´„ÇÄ„Åë„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
  </div>

  <!-- OVERLAY 1 ‚Äî confirmation -->
  <div id="overlay1" class="overlay" aria-label="„ÇÅ„ÅÑ„Çç„Å∏„ÅÑ„ÅèÔºü">
    <h1 class="overlayHeading">„Éñ„Éº„Éè„Éº„ÇÅ„ÅÑ„Çç„Å´„ÅÑ„ÅèÔºü</h1>
    <div class="btnRow">
      <button id="returnBtn" class="btnBlue" type="button">„ÅÑ„Åã„Å™„ÅÑ</button>
      <div class="sparkleWrap">
        <div class="sparkleField" id="confirmSparkles" aria-hidden="true"></div>
        <button id="continueBtn" class="btnPink" type="button">„ÅÑ„ÅèÔºÅ</button>
      </div>
    </div>
  </div>

  <!-- VIDEO WRAP -->
  <div id="videoWrap" aria-hidden="true">
    <video id="toMazeVideo" preload="auto" playsinline webkit-playsinline>
      <source src="assets/video/to-the-maze.mp4" type="video/mp4" />
    </video>
  </div>

  <!-- OVERLAY 2 ‚Äî ghost + start -->
  <div id="overlay2" class="overlay" aria-label="„Çπ„Çø„Éº„Éà">
    <h1 class="overlayHeading">„Éñ„Éº„Éè„Éº „ÇÅ„ÅÑ„Çç</h1>
    <p class="overlaySub">„Éñ„Éº„Éè„Éº„Çí„Çø„ÉÉ„ÉÅ„Åó„Å¶„ÅØ„Åò„ÇÅ„Çà„ÅÜÔºÅ</p>
    <button id="mazeStartBtn" class="ghostBtnWrap" type="button" aria-label="„Çπ„Çø„Éº„Éà">
      <div class="ghostSparkleField" id="startSparkles" aria-hidden="true"></div>
      <img id="startGhost" alt="„Éñ„Éº„Éè„Éº" />
    </button>
  </div>

  <!-- MAZE SCENE -->
  <section id="mazeScene" aria-label="„ÇÅ„ÅÑ„Çç">
    <div id="stage">
      <img id="mazeImg" src="assets/img/maze.png" alt="„ÇÅ„ÅÑ„Çç" />
      <div id="hitLayer" aria-hidden="true">
        <div id="grid"></div>
        <div id="crosshair">
          <div class="chLineH"></div>
          <div class="chLineV"></div>
        </div>
      </div>
    </div>
    <div id="hud">
      <div class="hudTitle">BOOHA<br>ADVENTURE</div>
      <div id="coordPill" class="pill">
        <div class="coordSmall">COORDINATES</div>
        <div class="coordBig" id="coordText">x: ‚Äî  y: ‚Äî</div>
        <div class="coordSmall" style="margin-top:6px;opacity:.9;">click to copy</div>
      </div>
    </div>
    <img id="avatar" alt="„Éñ„Éº„Éè„Éº" />
    <button id="bryanBtn" type="button" aria-label="Bryan mode">BRYAN</button>
    <button id="backBtn"  type="button" aria-label="„ÇÇ„Å©„Çã">„ÇÇ„Å©„Çã</button>
  </section>

  <div id="fade" aria-hidden="true"></div>
</div>

<audio id="bgMusic" src="assets/audio/sneaky.mp3" loop preload="auto"></audio>

<script>
  const BRYAN_PASS = 'him141amra803';
  const GHOSTS = [
    'assets/img/booha_ghost.png','assets/img/blue-boo.png',
    'assets/img/green-boo.png','assets/img/pink-boo.png','assets/img/purple-boo.png'
  ];

  const rotateOverlay   = document.getElementById('rotateOverlay');
  const overlay1        = document.getElementById('overlay1');
  const overlay2        = document.getElementById('overlay2');
  const videoWrap       = document.getElementById('videoWrap');
  const toMazeVideo     = document.getElementById('toMazeVideo');
  const returnBtn       = document.getElementById('returnBtn');
  const continueBtn     = document.getElementById('continueBtn');
  const mazeStartBtn    = document.getElementById('mazeStartBtn');
  const startGhost      = document.getElementById('startGhost');
  const confirmSparkles = document.getElementById('confirmSparkles');
  const startSparkles   = document.getElementById('startSparkles');
  const fade            = document.getElementById('fade');
  const bgMusic         = document.getElementById('bgMusic');
  const avatar          = document.getElementById('avatar');
  const mazeImg         = document.getElementById('mazeImg');
  const hitLayer        = document.getElementById('hitLayer');
  const grid            = document.getElementById('grid');
  const crosshair       = document.getElementById('crosshair');
  const bryanBtn        = document.getElementById('bryanBtn');
  const backBtn         = document.getElementById('backBtn');
  const coordPill       = document.getElementById('coordPill');
  const coordText       = document.getElementById('coordText');
  const FADE_MS         = 520;

  // ‚îÄ‚îÄ Rotate detection ‚îÄ‚îÄ
  const isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)
                || (navigator.maxTouchPoints > 1 && /Mac/.test(navigator.userAgent));
  function checkOrientation(){
    if(!isMobile){ rotateOverlay.classList.remove('show'); return; }
    rotateOverlay.classList.toggle('show', window.innerHeight > window.innerWidth);
  }
  window.addEventListener('resize', checkOrientation, {passive:true});
  window.addEventListener('orientationchange', ()=>setTimeout(checkOrientation,150), {passive:true});
  checkOrientation();

  // ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ
  function fadeToBlack(on){ fade.classList.toggle('on', !!on); }
  function pickRandom(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
  function assignRandomGhost(){
    const src = pickRandom(GHOSTS);
    startGhost.src = avatar.src = src;
    const r = (Math.random()*10-5).toFixed(2)+'deg';
    avatar.style.setProperty('--r',r);
    startGhost.style.setProperty('--r',r);
  }

  // ‚îÄ‚îÄ Sparkles ‚îÄ‚îÄ
  function buildSparkles(container, count=24, wide=false){
    container.innerHTML='';
    for(let i=0;i<count;i++){
      const sp=document.createElement('div'); sp.className='sp';
      const angle=(i/count)*Math.PI*2;
      const radius= wide ? (35+Math.random()*28) : (28+Math.random()*18);
      const cx=50+Math.cos(angle)*radius, cy=50+Math.sin(angle)*radius;
      const size= wide ? (3+Math.random()*4) : (2+Math.random()*3);
      const dur=1.3+Math.random()*1.8, delay=-(Math.random()*dur);
      sp.style.cssText=`--size:${size}px;--x:${cx}%;--y:${cy}%;--dur:${dur}s;--delay:${delay}s;`;
      container.appendChild(sp);
    }
  }
  buildSparkles(confirmSparkles, 24);
  // Ghost sparkle field is bigger ‚Äî more sparkles, wider spread
  buildSparkles(startSparkles, 36, true);

  // ‚îÄ‚îÄ Overlay 1 ‚îÄ‚îÄ
  returnBtn.addEventListener('click', ()=>{
    fadeToBlack(true);
    setTimeout(()=>{ window.location.href='index.html'; }, FADE_MS);
  });

  let videoPlayed=false;
  continueBtn.addEventListener('click', async ()=>{
    if(videoPlayed) return; videoPlayed=true;
    // Dismiss overlay 1
    overlay1.classList.add('hidden');
    overlay1.addEventListener('transitionend', ()=>overlay1.classList.add('gone'), {once:true});
    // Show and play video WITH audio (gesture just happened ‚Äî browser allows it)
    videoWrap.classList.add('show');
    try{ toMazeVideo.currentTime=0; }catch(e){}
    try{ await toMazeVideo.play(); }catch(e){ showOverlay2(); }
  });

  // ‚îÄ‚îÄ Video ‚Üí Overlay 2 ‚îÄ‚îÄ
  let overlay2Shown=false;
  function showOverlay2(){
    if(overlay2Shown) return; overlay2Shown=true;
    videoWrap.classList.remove('show');
    overlay2.classList.add('show');
  }
  toMazeVideo.addEventListener('ended', showOverlay2);
  toMazeVideo.addEventListener('error', showOverlay2);
  toMazeVideo.addEventListener('timeupdate', ()=>{
    const d=toMazeVideo.duration;
    if(!isFinite(d)||d<=0) return;
    if(d-toMazeVideo.currentTime<=0.5) showOverlay2();
  });

  // ‚îÄ‚îÄ Overlay 2 ‚Üí Start ‚îÄ‚îÄ
  let mazeStarted=false;
  mazeStartBtn.addEventListener('click', async ()=>{
    if(mazeStarted) return; mazeStarted=true;
    overlay2.classList.add('hidden');
    overlay2.addEventListener('transitionend', ()=>overlay2.remove(), {once:true});
    // sneaky.mp3 starts looping ‚Äî user gesture unlocks audio
    try{ bgMusic.volume=0.65; await bgMusic.play(); }
    catch(e){ console.warn('Music blocked:',e); }
  });

  // ‚îÄ‚îÄ Back button (in-maze) ‚îÄ‚îÄ
  backBtn.addEventListener('click', ()=>{
    try{ bgMusic.pause(); bgMusic.currentTime=0; }catch(e){}
    fadeToBlack(true);
    setTimeout(()=>{ window.location.href='index.html'; }, FADE_MS);
  });

  // ‚îÄ‚îÄ Visibility ‚îÄ‚îÄ
  document.addEventListener('visibilitychange', ()=>{
    if(document.hidden){
      try{ toMazeVideo.pause(); }catch(e){}
      try{ bgMusic.pause(); }catch(e){}
    } else {
      if(videoPlayed&&!overlay2Shown) try{ toMazeVideo.play(); }catch(e){}
      if(mazeStarted) try{ bgMusic.play(); }catch(e){}
    }
  });

  // ‚îÄ‚îÄ Bryan mode ‚îÄ‚îÄ
  let bryanOn=false;
  function applyBryanUI(){
    bryanBtn.classList.toggle('on',bryanOn);
    grid.classList.toggle('show',bryanOn);
    coordPill.classList.toggle('show',bryanOn);
    crosshair.classList.toggle('show',bryanOn);
    hitLayer.style.cursor=bryanOn?'crosshair':'default';
    if(bryanOn) requestAnimationFrame(positionHitLayer);
  }
  const dotLayer=document.createElement('div');
  dotLayer.style.cssText='position:absolute;inset:0;pointer-events:none;';
  hitLayer.appendChild(dotLayer);
  function placeDot(lx,ly,ix,iy){
    const dot=document.createElement('div');
    dot.style.cssText=`position:absolute;left:${lx}px;top:${ly}px;width:10px;height:10px;
      border-radius:50%;background:#ff3bbd;
      box-shadow:0 0 0 2px #fff,0 0 10px rgba(255,59,189,.8);
      transform:translate(-50%,-50%);pointer-events:none;`;
    const label=document.createElement('div');
    label.textContent=`${ix},${iy}`;
    label.style.cssText=`position:absolute;left:10px;top:-8px;font-size:11px;font-weight:900;
      letter-spacing:.5px;color:#fff;background:rgba(0,0,0,.72);
      padding:2px 5px;border-radius:4px;white-space:nowrap;pointer-events:none;`;
    dot.appendChild(label); dotLayer.appendChild(dot);
  }
  function clearDots(){ dotLayer.innerHTML=''; }
  bryanBtn.addEventListener('click', ()=>{
    if(bryanOn){ bryanOn=false; clearDots(); coordText.textContent='x: ‚Äî  y: ‚Äî'; applyBryanUI(); return; }
    const pw=prompt('Bryan mode password:');
    if(pw===null) return;
    String(pw).trim()===BRYAN_PASS ? (bryanOn=true, applyBryanUI()) : alert('Nope.');
  });

  // ‚îÄ‚îÄ Hit layer / coords ‚îÄ‚îÄ
  function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }
  function positionHitLayer(){
    const r=mazeImg.getBoundingClientRect();
    const s=document.getElementById('stage').getBoundingClientRect();
    hitLayer.style.left=(r.left-s.left)+'px'; hitLayer.style.top=(r.top-s.top)+'px';
    hitLayer.style.width=r.width+'px'; hitLayer.style.height=r.height+'px';
  }
  function getImageCoords(cx,cy){
    const rect=hitLayer.getBoundingClientRect();
    const x=cx-rect.left, y=cy-rect.top;
    return{ x:Math.round(clamp(x/rect.width,0,1)*(mazeImg.naturalWidth||0)),
      y:Math.round(clamp(y/rect.height,0,1)*(mazeImg.naturalHeight||0)), localX:x, localY:y };
  }
  function setCrosshair(lx,ly){
    const h=crosshair.querySelector('.chLineH'), v=crosshair.querySelector('.chLineV');
    if(h) h.style.transform=`translateY(${ly}px)`;
    if(v) v.style.transform=`translateX(${lx}px)`;
  }
  async function copyText(txt){
    try{ await navigator.clipboard.writeText(txt); return true; }
    catch(e){ try{
      const ta=document.createElement('textarea');
      ta.value=txt; ta.style.cssText='position:fixed;left:-9999px';
      document.body.appendChild(ta); ta.focus(); ta.select();
      document.execCommand('copy'); document.body.removeChild(ta); return true;
    }catch(err){ return false; } }
  }
  hitLayer.addEventListener('mousemove', e=>{
    if(!bryanOn) return;
    const c=getImageCoords(e.clientX,e.clientY);
    coordText.textContent=`x: ${c.x}  y: ${c.y}`;
    setCrosshair(c.localX,c.localY);
  });
  hitLayer.addEventListener('click', async e=>{
    if(!bryanOn) return;
    const c=getImageCoords(e.clientX,e.clientY);
    coordText.textContent=`x: ${c.x}  y: ${c.y}`;
    setCrosshair(c.localX,c.localY);
    placeDot(c.localX,c.localY,c.x,c.y);
    const ok=await copyText(`${c.x},${c.y}`);
    if(ok){ coordPill.style.transform='scale(1.02)'; setTimeout(()=>coordPill.style.transform='',120); }
  });
  coordPill.addEventListener('click', async ()=>{
    if(!bryanOn) return;
    const m=coordText.textContent.match(/x:\s*(\d+)\s*y:\s*(\d+)/);
    await copyText(m?`${m[1]},${m[2]}`:coordText.textContent);
  });
  window.addEventListener('resize', positionHitLayer, {passive:true});
  if(mazeImg.complete) setTimeout(positionHitLayer,0);
  else mazeImg.addEventListener('load',()=>setTimeout(positionHitLayer,0));

  // ‚îÄ‚îÄ Init ‚îÄ‚îÄ
  assignRandomGhost();
</script>
</body>
</html>
